<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Một chút về Driver cho USB Device trong Linux - Lazytrick - Limited size memory of mind</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	
	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	
	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="Lazytrick - Limited size memory of mind" rel="home">
				<div class="logo__title">Lazytrick - Limited size memory of mind</div>
				
			</a>
		</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">Home</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/post/">Viết những gì?</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/tags/">Tags</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/categories/">Category</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about/">Ai viết?</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Một chút về Driver cho USB Device trong Linux</h1>
			
			


<br>
<i data-feather="calendar">
  Published: <b><time datetime="2016-08-15 00:00:00 &#43;0700">Mon, 15 Aug 2016 05:47:10</time></b> | Last modified:<b><time datetime="2016-08-15 00:00:00 &#43;0700">Mon, 15 Aug 2016 05:47:10</time></b>
  </i> 
		</header><div class="content post__content clearfix">
			<p>Trong loại bài dịch <a href="https://lazytrick.wordpress.com/2016/01/25/usb-driver-va-usb-device-firmware-se-viet/">trước đây</a> nói về USB, tôi có nhắc một chút đến việc load đúng driver thì phía Host làm thế nào?</p>

<p>Như ta đã biết, khi một thiết bị USB được cắm vào máy (Host), phía Host sẽ thực hiện một loạt thao tác từ xác định nguồn (bus, hay self), lấy thông tin tốc độ, các thông tin về descriptor (thiết bị, giao diện, các Endpoint). Cuối cùng để sử dụng các tính năng chính mà thiết bị cung cấp, thì hệ điều hành phía Host, dù là Windows, hay Linux, hay MacOS sẽ phải load driver tương ứng với thiết bị.</p>

<p>Để xác định đúng driver cần load, phía Host thường sử dụng 2 thông số. Đó là <strong>Product ID/Vendor ID</strong></p>

<p>Trường hợp hệ điều hành Linux, hầu hết Driver cho thiết bị được tích hợp sẵn trong source của nhân. Tất nhiên, với mỗi cấu hình build khác nhau, người ta có thể biên dịch cùng hoặc bỏ qua.<br />
Trong linux, mỗi driver sẽ cho Kernel biết một danh sách các thiết bị (mỗi thiết bị thường được đặc trưng bởi 2 thông số ở <strong>Product ID/Vendor ID</strong> đã nói phía trên).<br />
Kernel sẽ lựa chọn driver phù hợp nhất.</p>

<p>Như một tìm hiểu nhỏ, cho bài viết <a href="https://lazytrick.wordpress.com/2016/08/11/cai-them-driver-usb-wifi-adapter-cho-ban-build-raspbery-pi-su-dung-yocto-project-chua-xong/">Cài thêm driver cho bản build Raspberry PI sử dụng Yocto</a>.</p>

<p>Ta xét đến thiết bị USB-Wifi Adapter của Buffalo, link sản phẩm tại <a href="http://buffalo.jp/product/wireless-lan/client/wli-uc-gnm2/">đây</a>.</p>

<p>Thiết bị chạy tốt trên Ubuntu, Raspbian vì thế ta có thể thấy các thông số của thiết bị tại log của 2 hệ điều hành này.<br />
Từ đó ta thấy được:</p>

<ol>
<li>Thiết bị sử dụng chip không dây của Ralink (xem thêm tại <a href="https://en.wikipedia.org/wiki/Ralink">https://en.wikipedia.org/wiki/Ralink</a>)</li>
<li>Trong source của nhân linux, dường như có 1 loạt thiết bị không dây Ralink đang được hỗ trợ.<br />
Xem ở đây ta sẽ thấy: <a href="http://lxr.free-electrons.com/source/drivers/net/wireless/ralink/rt2x00/rt2800usb.c#L968">http://lxr.free-electrons.com/source/drivers/net/wireless/ralink/rt2x00/rt2800usb.c#L968</a></li>
</ol>

<p>Vậy thì tại sao bản build <strong>rpi-basic-image</strong> lại không có.???</p>

<ol>
<li>Trong log mà ta có được, có xuất hiện một dòng liên quan đến firmware request.<br />
Vậy có quan hệ gì nữa Driver trong Kernel, module, và firmware??<br />
Dường như kernel cho phép load firmware để hỗ trợ các driver mà nó sử dụng.</li>
</ol>

<p>Update 2016/09/06:<br />
Từ kêt quả tìm hiểu về <a href="https://lazytrick.wordpress.com/2016/08/29/khai-niem-driver-va-firmware-trong-linux/">Driver và Firmware trong Linux</a>, <a href="https://lazytrick.wordpress.com/2016/09/05/qua-trinh-load-firmware-cua-driver-trong-linux/">Quá trình load firmware của Driver trong Linux</a>, <a href="https://lazytrick.wordpress.com/2016/08/19/xac-dinh-cac-driver-module-dang-duoc-su-dung-tren-linux/">Tìm Driver cho Linux</a></p>

<p>Ta có thể thấy rằng, với thiết bị USB Wifi Client của chúng ta, ta chỉ cần tạo thư mục <strong>/lib/firmware/</strong> và copy firmware còn thiếu vào là sẽ chạy được.<br />
Tuy nhiên để tạo ra bản build chưa sẵn các firmware này thì ta phải thêm recipy <strong>linux-firmware</strong> vào image.</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link btn" href="/tags/driver/" rel="tag">Driver</a></li>
	</ul>
</div>
		</footer>
	</article>
</main>



<section class="comments">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-blog-lazytrick-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2019 Lazytrick - Limited size memory of mind.
			<span class="footer__copyright-credits">Convert nội dung Markdown sang HTML bằng <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and sử dụng theme <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a>.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>